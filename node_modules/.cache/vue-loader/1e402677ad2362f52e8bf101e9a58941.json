{"remainingRequest":"/Users/k17111kk/TechTrain/techTrain_mission/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/k17111kk/TechTrain/techTrain_mission/src/views/Detail.vue?vue&type=style&index=0&id=40f4caea&scoped=true&lang=css&","dependencies":[{"path":"/Users/k17111kk/TechTrain/techTrain_mission/src/views/Detail.vue","mtime":1575525183874},{"path":"/Users/k17111kk/TechTrain/techTrain_mission/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/k17111kk/TechTrain/techTrain_mission/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/k17111kk/TechTrain/techTrain_mission/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/k17111kk/TechTrain/techTrain_mission/node_modules/vuetify-loader/lib/loader.js","mtime":1564062719000},{"path":"/Users/k17111kk/TechTrain/techTrain_mission/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/k17111kk/TechTrain/techTrain_mission/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5iZy1saWdodGVuLTQtYmx1ZSB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2JiZGVmYjsKfQo="},{"version":3,"sources":["Detail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+ZA;AACA;AACA","file":"Detail.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <v-app>\n    <div class=\"detail\">\n      <template v-if=\"this.loading\">\n        <vue-loading\n          type=\"balls\"\n          color=\"#333\"\n          :size=\"{ width: '50px', height: '50px' }\"\n        ></vue-loading>\n      </template>\n      <template v-else>\n        <v-container class=\"mx-auto text-left p-3\">\n          <h1>{{ company.name }}</h1>\n          <v-list disabled>\n            <v-subheader\n              >DETAILS<span v-for=\"key in this.averageRate\">\n                <v-icon small color=\"yellow\">star</v-icon> </span\n              ><template v-if=\"this.chat.length > 0\"\n                >({{ this.chat.length }})</template\n              ></v-subheader\n            >\n            <v-list-item-group>\n              <v-list-item>\n                <v-list-item-icon>\n                  <v-icon class=\"headline\">mdi-domain</v-icon>\n                </v-list-item-icon>\n                <v-list-item-content>\n                  <v-list-item-title\n                    class=\"headline\"\n                    v-text=\"company.name\"\n                  ></v-list-item-title>\n                </v-list-item-content>\n              </v-list-item>\n              <v-list-item>\n                <v-list-item-icon>\n                  <v-icon>mdi-home</v-icon>\n                </v-list-item-icon>\n                <v-list-item-content>\n                  <v-list-item-title\n                    v-text=\"company.address\"\n                  ></v-list-item-title>\n                </v-list-item-content>\n              </v-list-item>\n              <v-list-item>\n                <v-list-item-icon>\n                  <v-icon>mdi-phone</v-icon>\n                </v-list-item-icon>\n                <v-list-item-content>\n                  <v-list-item-title\n                    v-text=\"company.phonenumber\"\n                  ></v-list-item-title>\n                </v-list-item-content>\n              </v-list-item>\n            </v-list-item-group>\n          </v-list>\n\n          <div\n            v-if=\"this.ratingUser[0].answer == 'yes'\"\n            class=\"mx-auto text-left p-3\"\n          >\n            <div class=\"headline\">説明会に行った人向け<br /></div>\n            <div class=\"p-3\">\n              就職後この地方で働けますか?\n              <v-btn small depressed disabled color=\"primary\">はい</v-btn>\n              <v-btn\n                small\n                depressed\n                color=\"error\"\n                @click=\"\n                  updateVoting(\n                    'no',\n                    company.key,\n                    ratingUser[0].key,\n                    company.select\n                  )\n                \"\n                >いいえ</v-btn\n              >\n            </div>\n          </div>\n          <div\n            v-else-if=\"this.ratingUser[0].answer == 'no'\"\n            class=\"mx-auto text-left p-3\"\n          >\n            <div class=\"headline\">説明会に行った人向け<br /></div>\n            <div class=\"p-3\">\n              就職後この地方で働けますか?\n              <v-btn\n                small\n                depressed\n                color=\"primary\"\n                @click=\"\n                  updateVoting(\n                    'yes',\n                    company.key,\n                    ratingUser[0].key,\n                    company.select\n                  )\n                \"\n                >はい</v-btn\n              >\n              <v-btn small depressed disabled color=\"error\">いいえ</v-btn>\n            </div>\n          </div>\n          <template v-else>\n            <div class=\"headline\">説明会に行った人向け<br /></div>\n            <div class=\"p-3\">\n              就職後この地方で働けますか?\n              <v-btn\n                small\n                depressed\n                color=\"primary\"\n                @click=\"voting('yes', company.key, company.select)\"\n                >はい</v-btn\n              >\n              <v-btn\n                small\n                depressed\n                color=\"error\"\n                @click=\"voting('no', company.key, company.select)\"\n                >いいえ</v-btn\n              >\n            </div>\n          </template>\n          <div class=\"headline\">みんなの意見<br /></div>\n          <div class=\"p-3\">\n            {{ this.manyAnswer[0].text }}(はい:{{\n              this.manyAnswer[0].yes\n            }},いいえ:{{ this.manyAnswer[0].no }})\n          </div>\n        </v-container>\n        <v-container>\n          <v-card class=\"p-3 text-left bg-lighten-4-blue\">\n            <h2>レビュー</h2>\n            <!--Firebase から取得したリストを描画（トランジション付き）-->\n            <v-window class=\"elevation-1\" :vertical=\"false\" :show-arrows=\"true\">\n              <v-window-item\n                v-for=\"{\n                  key,\n                  name,\n                  image,\n                  message,\n                  companykey,\n                  ratings\n                } in chat\"\n                :key=\"key\"\n              >\n                <v-card flat>\n                  <v-card-text>\n                    <v-row class=\"m-4\" align=\"center\">\n                      <!-- <v-avatar color=\"grey\" class=\"mr-4\"></v-avatar> -->\n                      <strong class=\"title ml-5\">{{ name }}</strong>\n                      <v-spacer></v-spacer>\n                      <v-btn icon class=\"mr-5\">\n                        <span v-for=\"key in ratings\">\n                          <v-icon small color=\"yellow\">star</v-icon>\n                        </span>\n                      </v-btn>\n                    </v-row>\n                    <v-row class=\"m-4\">\n                      <p class=\"ml-5\">\n                        {{ message }}\n                      </p>\n                    </v-row>\n                  </v-card-text>\n                </v-card>\n              </v-window-item>\n            </v-window>\n          </v-card>\n        </v-container>\n        <v-container>\n          <v-toolbar flat color=\"blue-grey\" dark>\n            <v-toolbar-title>Submit a post</v-toolbar-title>\n          </v-toolbar>\n          <v-card-text>\n            <v-textarea\n              filled\n              label=\"Text\"\n              placeholder=\"コメントを残す\"\n              v-model=\"input\"\n            ></v-textarea>\n            <v-rating v-model=\"rating\" color=\"yellow\"></v-rating>\n          </v-card-text>\n          <v-card-actions>\n            <v-spacer></v-spacer>\n            <v-btn color=\"success\" depressed @click=\"doSend(company.key)\">\n              Post\n            </v-btn>\n          </v-card-actions>\n        </v-container>\n      </template>\n    </div>\n  </v-app>\n</template>\n<script>\nimport { mapState } from \"vuex\";\nimport firebase from \"firebase\";\nimport Nl2br from \"vue-nl2br\";\nimport { VueLoading } from \"vue-loading-template\";\nexport default {\n  components: { Nl2br, VueLoading },\n  data() {\n    return {\n      user: {}, // ユーザー情報\n      chat: [], // 取得したメッセージを入れる配列\n      ratingUser: [\n        {\n          key: \"\",\n          answer: \"\",\n          name: \"\"\n        }\n      ],\n      ratings: [],\n      loading: true,\n      input: \"\", // 入力したメッセージ\n      rating: 3,\n      answer: \"\",\n      companyData: [],\n      oneCompany: [],\n      companykey: this.$store.state.company.key\n    };\n  },\n  created() {\n    firebase.auth().onAuthStateChanged(user => {\n      this.user = user ? user : {};\n      this.chat = [];\n      this.ratings = [];\n      const ref_message = firebase\n        .database()\n        .ref(\"comment/\" + this.$store.state.company.key);\n      const ref_ratings_user = firebase\n        .database()\n        .ref(\"ratings/\" + this.$store.state.company.key + \"/\" + this.user.uid);\n      const ref_rating_company = firebase\n        .database()\n        .ref(this.$store.state.company.select);\n      ref_message.limitToLast(100).on(\"child_added\", this.childAdded);\n      ref_ratings_user\n        .limitToLast(100)\n        .on(\"child_added\", this.childRatingUserAdded);\n      ref_rating_company\n        .limitToLast(100)\n        .on(\"child_added\", this.childCompanyAdded);\n    });\n  },\n  mounted() {\n    setTimeout(() => {\n      this.loading = false;\n    }, 1000);\n  },\n  computed: {\n    ...mapState({\n      company: \"company\"\n    }),\n    averageRate: function() {\n      var sum = 0;\n      if (this.chat.length <= 0) {\n        return 3;\n      }\n      this.chat.forEach(function(value) {\n        sum = sum + value.ratings;\n      });\n      return Math.round(sum / this.chat.length);\n    },\n    manyAnswer: function() {\n      var companykey = this.companykey;\n      var voteitems = [{ yes: 0, no: 0, text: \"\", rateKey: \"\" }];\n      if (this.companyData == null) {\n        return 0;\n      } else {\n        this.companyData.forEach(function(value) {\n          if (value.yes == null) {\n          } else if (companykey == value.key) {\n            voteitems[0].yes = value.yes;\n            voteitems[0].no = value.no;\n            voteitems[0].rateKey = value.key;\n          }\n        });\n        if (voteitems[0].yes == 0 && voteitems[0].no == 0) {\n          voteitems[0].text = \"まだ投票されていません\";\n          return voteitems;\n        }\n        if (voteitems[0].yes > voteitems[0].no) {\n          voteitems[0].text = \"この地方で働けます\";\n          return voteitems;\n        }\n        voteitems[0].text = \"この地方では働けません\";\n        return voteitems;\n      }\n    }\n  },\n  methods: {\n    childAdded(snap) {\n      const message = snap.val();\n      this.chat.push({\n        key: snap.key,\n        name: message.name,\n        image: message.image,\n        message: message.message,\n        companykey: message.companykey,\n        ratings: message.ratings\n      });\n    },\n    childRatingUserAdded(snap) {\n      const rates = snap.val();\n      this.ratingUser = [\n        {\n          key: snap.key,\n          answer: rates.answer,\n          name: rates.name\n        }\n      ];\n    },\n    childCompanyAdded(snap) {\n      const company = snap.val();\n      this.companyData.push({\n        key: snap.key,\n        yes: company.yes,\n        no: company.no\n      });\n    },\n    doSend(sendkey) {\n      if (this.user.uid && this.input.length) {\n        // firebase にメッセージを追加\n        firebase\n          .database()\n          .ref(\"comment/\" + sendkey)\n          .push(\n            {\n              message: this.input,\n              name: this.user.displayName,\n              image: this.user.photoURL,\n              companykey: sendkey,\n              ratings: this.rating,\n              user: this.user.uid\n            },\n            () => {\n              this.input = \"\"; // フォームを空にする\n            }\n          );\n      }\n    },\n    voting(str, sendkey, select) {\n      this.answer = str;\n      firebase\n        .database()\n        .ref(\"ratings/\" + sendkey + \"/\" + this.user.uid)\n        .push({\n          answer: this.answer,\n          name: this.user.displayName\n        });\n      if (str == \"yes\") {\n        firebase\n          .database()\n          .ref(select)\n          .child(sendkey)\n          .update({\n            yes: this.manyAnswer[0].yes + 1\n          });\n      } else {\n        firebase\n          .database()\n          .ref(select)\n          .child(sendkey)\n          .update({\n            no: this.manyAnswer[0].no + 1\n          });\n      }\n      const ref_rating_company = firebase.database().ref(select);\n      ref_rating_company\n        .limitToLast(100)\n        .on(\"child_added\", this.childCompanyAdded);\n      this.ratingUser[0].answer = str;\n    },\n    updateVoting(str, companykey, key, select) {\n      firebase\n        .database()\n        .ref(\"ratings/\" + companykey + \"/\" + this.user.uid)\n        .child(key)\n        .update({\n          answer: str\n        });\n      if (str == \"yes\") {\n        firebase\n          .database()\n          .ref(select)\n          .child(this.manyAnswer[0].rateKey)\n          .update({\n            yes: this.manyAnswer[0].yes + 1,\n            no: this.manyAnswer[0].no - 1\n          });\n      } else {\n        firebase\n          .database()\n          .ref(select)\n          .child(this.manyAnswer[0].rateKey)\n          .update({\n            yes: this.manyAnswer[0].yes - 1,\n            no: this.manyAnswer[0].no + 1\n          });\n      }\n      const ref_rating_company = firebase.database().ref(select);\n      ref_rating_company\n        .limitToLast(100)\n        .on(\"child_added\", this.childCompanyAdded);\n      this.ratingUser[0].answer = str;\n    },\n    moveUrl(url) {\n      document.location.href = url;\n    }\n  }\n};\n</script>\n\n<style scoped>\n.bg-lighten-4-blue {\n  background-color: #bbdefb;\n}\n</style>\n"]}]}